<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Snake Neo">
    <title>Snake: Psychedelic Edition</title>
    <style>
        /* Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ· Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; }
        body { 
            background: #000; overflow: hidden; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; width: 100vw; font-family: sans-serif;
            transition: background 0.1s ease; touch-action: none;
        }
        canvas { display: block; width: 100vw; height: 100vh; }
        #ui { position: absolute; top: 40px; width: 100%; display: flex; justify-content: space-around; color: #fff; font-size: 18px; font-weight: bold; z-index: 5; pointer-events: none; }
        #power-status { position: absolute; top: 75px; font-size: 16px; font-weight: bold; }
        #overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        button { background: linear-gradient(45deg, #00ffcc, #00bbff); border: none; padding: 15px 40px; font-size: 20px; border-radius: 50px; font-weight: bold; color: #000; }
        .pulse-bg { background: #1a0033 !important; }
    </style>
</head>
<body>

<div id="ui">
    <div>SCORE: <span id="score">0</span></div>
    <div>LEVEL: <span id="level">1</span></div>
</div>
<div id="power-status"></div>

<div id="overlay">
    <h1 style="color: #fff; margin-bottom: 20px;">GAME OVER</h1>
    <button onclick="resetGame()">PLAY AGAIN</button>
</div>

<canvas id="game"></canvas>

<script>
    // Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ù€ JavaScript Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ù„ÙŠ Ø¨Ø¹ØªÙ‡ÙˆÙ„Ùƒ Ø¨Ø§Ù„Ø¸Ø¨Ø· Ù‡Ù†Ø§
    // (ÙˆØ¶Ø¹Øª Ù„Ùƒ Ù‡Ù†Ø§ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„Ù‡Ø§ ÙƒØªØ·Ø¨ÙŠÙ‚)
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const body = document.body;
    const scoreElement = document.getElementById("score");
    const levelElement = document.getElementById("level");
    const powerStatus = document.getElementById("power-status");
    const overlay = document.getElementById("overlay");

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    let box = Math.floor(canvas.width / 22);
    let snake, direction, food, obstacles, score, level, speed, gameLoop;
    let powerUp = { x: -100, y: -100, type: null, angle: 0 };
    let timers = { shield: 0, magnet: 0 };
    let smokeParticles = []; 
    let sparkParticles = [];

    const rainbow = ["#FF0000", "#FF7F00", "#FFFF00", "#00FF00", "#0000FF", "#4B0082", "#9400D3"];

    function init() {
        snake = [{x: 10 * box, y: 10 * box}, {x: 9 * box, y: 10 * box}, {x: 8 * box, y: 10 * box}];
        direction = "RIGHT"; score = 0; level = 1; speed = 120;
        scoreElement.innerText = score; levelElement.innerText = level;
        overlay.style.display = "none";
        obstacles = []; for(let i=0; i<6; i++) spawnObstacle();
        spawnFood(); smokeParticles = []; sparkParticles = [];
        powerUp.type = null;
        if(gameLoop) clearInterval(gameLoop);
        gameLoop = setInterval(draw, speed);
    }

    function createSparks(x, y, color) {
        for(let i=0; i<15; i++) {
            sparkParticles.push({ x: x, y: y, size: Math.random() * 4 + 2, color: color, vx: (Math.random() - 0.5) * 10, vy: (Math.random() - 0.5) * 10, life: 1.0 });
        }
    }

    function createSmoke(x, y, color) {
        for(let i=0; i<3; i++) { 
            smokeParticles.push({ x: x + box/2, y: y + box/2, size: Math.random() * (box / 4) + 2, color: color, alpha: 0.5, vx: (Math.random() - 0.5) * 1, vy: (Math.random() - 0.5) * 1 });
        }
    }

    function spawnFood() { food = { x: Math.floor(Math.random() * (Math.floor(canvas.width/box))) * box, y: Math.floor(Math.random() * (Math.floor(canvas.height/box))) * box }; }

    function spawnPowerUp() {
        const types = ['shield', 'magnet'];
        powerUp = { x: Math.floor(Math.random() * (Math.floor(canvas.width/box))) * box, y: Math.floor(Math.random() * (Math.floor(canvas.height/box))) * box, type: types[Math.floor(Math.random() * types.length)], angle: 0 };
    }

    function spawnObstacle() {
        let ob = { x: Math.floor(Math.random() * (Math.floor(canvas.width/box))) * box, y: Math.floor(Math.random() * (Math.floor(canvas.height/box))) * box };
        if(Math.abs(ob.x - snake[0].x) < box*4) return spawnObstacle();
        obstacles.push(ob);
    }

    function draw() {
        ctx.fillStyle = "rgba(0,0,0,0.4)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        sparkParticles.forEach((sp, i) => {
            sp.x += sp.vx; sp.y += sp.vy; sp.life -= 0.03;
            if(sp.life <= 0) sparkParticles.splice(i, 1);
            else { ctx.fillStyle = sp.color; ctx.globalAlpha = sp.life; ctx.fillRect(sp.x, sp.y, sp.size, sp.size); }
        });
        ctx.globalAlpha = 1;

        smokeParticles.forEach((p, index) => {
            p.x += p.vx; p.y += p.vy; p.alpha -= 0.1;
            if(p.alpha <= 0) smokeParticles.splice(index, 1);
            else { ctx.save(); ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); ctx.restore(); }
        });

        ctx.fillStyle = "#8e44ad";
        obstacles.forEach(ob => ctx.fillRect(ob.x + 2, ob.y + 2, box - 4, box - 4));

        ctx.fillStyle = "#ff0033";
        ctx.beginPath(); ctx.arc(food.x + box/2, food.y + box/2, box/2 - 2, 0, Math.PI*2); ctx.fill();

        if (powerUp.type) {
            powerUp.angle += 0.1;
            ctx.save();
            ctx.translate(powerUp.x + box/2, powerUp.y + box/2);
            ctx.rotate(powerUp.angle);
            ctx.strokeStyle = powerUp.type === 'shield' ? "#ffcc00" : "#00bbff";
            ctx.lineWidth = 3;
            ctx.strokeRect(-box/3, -box/3, box/1.5, box/1.5);
            ctx.restore();
        }

        snake.forEach((part, i) => {
            let color = timers.shield > 0 ? "#ffcc00" : rainbow[i % rainbow.length];
            ctx.fillStyle = color;
            if (i === snake.length - 1) createSmoke(part.x, part.y, color);
            ctx.beginPath(); ctx.arc(part.x + box/2, part.y + box/2, box/2 - 2, 0, Math.PI*2); ctx.fill();
        });

        if (timers.magnet > 0) {
            food.x += (snake[0].x - food.x) * 0.15;
            food.y += (snake[0].y - food.y) * 0.15;
        }

        let headX = snake[0].x; let headY = snake[0].y;
        if(direction === "LEFT") headX -= box; else if(direction === "RIGHT") headX += box;
        else if(direction === "UP") headY -= box; else if(direction === "DOWN") headY += box;

        if(headX < 0) headX = Math.floor(canvas.width/box) * box - box; else if(headX >= canvas.width) headX = 0;
        if(headY < 0) headY = Math.floor(canvas.height/box) * box - box; else if(headY >= canvas.height) headY = 0;

        let newHead = {x: headX, y: headY};

        if (Math.abs(headX - powerUp.x) < 5 && Math.abs(headY - powerUp.y) < 5) {
            timers[powerUp.type] = 100; powerUp.type = null;
        }

        let hitObstacle = obstacles.some(o => o.x === headX && o.y === headY);
        if(snake.some(p => p.x === newHead.x && p.y === newHead.y) || (hitObstacle && timers.shield <= 0)) {
            clearInterval(gameLoop); overlay.style.display = "flex"; return;
        }

        if(Math.abs(headX - food.x) < box && Math.abs(headY - food.y) < box) {
            score++; scoreElement.innerText = score; 
            createSparks(food.x, food.y, "#ff0033");
            body.classList.add("pulse-bg"); setTimeout(() => body.classList.remove("pulse-bg"), 100);
            spawnFood();
            if (score % 5 === 0) {
                spawnPowerUp(); level++; levelElement.innerText = level;
                speed = Math.max(40, speed - 5); clearInterval(gameLoop); gameLoop = setInterval(draw, speed);
                spawnObstacle();
            }
        } else { snake.pop(); }
        snake.unshift(newHead);

        if (timers.shield > 0) { timers.shield--; powerStatus.innerText = "ğŸ›¡ï¸ SHIELD: " + Math.ceil(timers.shield/10); }
        else if (timers.magnet > 0) { timers.magnet--; powerStatus.innerText = "ğŸ§² MAGNET: " + Math.ceil(timers.magnet/10); }
        else { powerStatus.innerText = ""; }
    }

    let startX, startY;
    document.addEventListener("touchstart", e => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, {passive: false});
    document.addEventListener("touchmove", e => { e.preventDefault(); }, {passive: false});
    document.addEventListener("touchend", e => {
        let dx = e.changedTouches[0].clientX - startX; let dy = e.changedTouches[0].clientY - startY;
        if(Math.abs(dx) > Math.abs(dy)) { if(dx > 20 && direction !== "LEFT") direction = "RIGHT"; else if(dx < -20 && direction !== "RIGHT") direction = "LEFT"; }
        else { if(dy > 20 && direction !== "UP") direction = "DOWN"; else if(dy < -20 && direction !== "DOWN") direction = "UP"; }
    });

    function resetGame() { timers.shield = 0; timers.magnet = 0; init(); }
    init();
</script>
</body>
</html>
